# Asset Management Guide

## ğŸ“ Directory Structure

```
pusdokkes-subunit/
â”œâ”€â”€ styles/                    â† Source files (edit these)
â”‚   â”œâ”€â”€ pd.ultrasafe.tokens.css
â”‚   â”œâ”€â”€ pd.framework-bridge.css
â”‚   â””â”€â”€ pd-safe-layers.css
â”‚
â”œâ”€â”€ scripts/                   â† Source files (edit these)
â”‚   â””â”€â”€ theme-toggle-v2.js
â”‚
â””â”€â”€ public/                    â† Web-accessible (auto-synced)
    â”œâ”€â”€ styles/
    â”‚   â”œâ”€â”€ pd.ultrasafe.tokens.css
    â”‚   â”œâ”€â”€ pd.framework-bridge.css
    â”‚   â””â”€â”€ pd-safe-layers.css
    â””â”€â”€ scripts/
        â””â”€â”€ theme-toggle-v2.js
```

## ğŸ”„ Workflow

### When Editing CSS/JS

1. **Edit source files:**
   ```
   styles/pd.ultrasafe.tokens.css
   styles/pd.framework-bridge.css
   scripts/theme-toggle-v2.js
   ```

2. **Sync to public:**
   ```bash
   # Windows
   sync-public-assets.bat
   
   # Or manually:
   copy styles\*.css public\styles\
   copy scripts\theme-toggle-v2.js public\scripts\
   ```

3. **Test changes:**
   ```bash
   php artisan serve
   # Open http://127.0.0.1:8000
   ```

4. **Commit both:**
   ```bash
   git add styles/ public/styles/
   git add scripts/ public/scripts/
   git commit -m "Update theme system"
   ```

## ğŸš€ For Deployment

### Files to Commit
âœ… **COMMIT these files to git:**
- `public/styles/pd*.css`
- `public/scripts/theme-toggle-v2.js`

These are needed for production servers.

### Files to Ignore
âŒ **DO NOT commit:**
- `public/build/*` (generated by Vite, except in production builds)
- `node_modules/`
- `.env`

## ğŸ› ï¸ Build Process

### Development
```bash
# Watch for changes
npm run dev

# Manually sync CSS/JS
sync-public-assets.bat
```

### Production
```bash
# Build optimized assets
npm run build

# Sync Safe Mode files
sync-public-assets.bat

# Deploy
git push origin main
```

## ğŸ“ Laravel Asset Loading

### In Blade Templates

**Safe Mode v2 files (from public/):**
```html
<!-- These load from public/styles/ -->
<link rel="stylesheet" href="{{ asset('styles/pd.ultrasafe.tokens.css') }}">
<link rel="stylesheet" href="{{ asset('styles/pd.framework-bridge.css') }}">

<!-- This loads from public/scripts/ -->
<script src="{{ asset('scripts/theme-toggle-v2.js') }}" defer></script>
```

**Vite-bundled files:**
```html
<!-- These load from public/build/ -->
@vite(['resources/css/app.css', 'resources/js/app.js'])
```

## ğŸ” Troubleshooting

### "File not found" errors

**Problem:** CSS/JS files return 404

**Solution:**
```bash
# Check files exist
dir public\styles
dir public\scripts

# If missing, sync:
sync-public-assets.bat
```

### "Styles not updating"

**Problem:** Changes not reflected on page

**Solution:**
```bash
# 1. Sync files
sync-public-assets.bat

# 2. Clear browser cache
# Ctrl+Shift+R (hard refresh)

# 3. Clear Laravel cache
php artisan cache:clear
php artisan view:clear
```

### "Wrong file version"

**Problem:** Old CSS/JS loading

**Solution:**
```bash
# 1. Check file timestamps
dir /T:W public\styles
dir /T:W public\scripts

# 2. Force re-copy
sync-public-assets.bat

# 3. Add cache busting (optional):
# {{ asset('styles/pd.ultrasafe.tokens.css?v='.time()) }}
```

## ğŸ¯ Best Practices

### 1. Always Sync After Edits
```bash
# Make changes
notepad styles\pd.ultrasafe.tokens.css

# Sync immediately
sync-public-assets.bat

# Test
php artisan serve
```

### 2. Commit Both Locations
```bash
git add styles/ public/styles/
git add scripts/ public/scripts/
git commit -m "Update theme colors"
```

### 3. Test Before Committing
```bash
# 1. Sync
sync-public-assets.bat

# 2. Test locally
php artisan serve

# 3. Run audit
npm run audit:guard

# 4. Commit if passed
git commit -m "..."
```

## ğŸ”§ Advanced: Automated Sync

### Option 1: Watch Script (PowerShell)

Create `watch-sync.ps1`:
```powershell
$watcher = New-Object System.IO.FileSystemWatcher
$watcher.Path = "styles"
$watcher.Filter = "*.css"
$watcher.IncludeSubdirectories = $false
$watcher.EnableRaisingEvents = $true

$action = {
    Write-Host "File changed: $($Event.SourceEventArgs.Name)"
    & .\sync-public-assets.bat
}

Register-ObjectEvent $watcher "Changed" -Action $action
```

Run: `powershell .\watch-sync.ps1`

### Option 2: Add to package.json

```json
{
  "scripts": {
    "sync": "node -e \"require('fs').cpSync('styles', 'public/styles', {recursive:true})\""
  }
}
```

Run: `npm run sync`

## ğŸ“Š File Sizes

**Current sizes:**
- `pd.ultrasafe.tokens.css`: ~19 KB (should be ~2 KB?)
- `pd.framework-bridge.css`: ~19 KB (should be ~8 KB?)
- `pd-safe-layers.css`: ~7.5 KB
- `theme-toggle-v2.js`: ~3 KB

**Note:** If files seem larger than expected, check for:
- Duplicate content
- Commented code
- Merged files

## âœ… Checklist

Before committing:
- [ ] Edited source files in `styles/` or `scripts/`
- [ ] Ran `sync-public-assets.bat`
- [ ] Tested locally with `php artisan serve`
- [ ] Ran `npm run audit:guard` (passed)
- [ ] Hard refreshed browser (Ctrl+Shift+R)
- [ ] Committed both source and public files

Before deploying:
- [ ] All audits passed
- [ ] Assets synced to public/
- [ ] Vite build completed (`npm run build`)
- [ ] Files committed to git
- [ ] `.env` configured for production

---

**Quick Commands:**

```bash
# Sync assets
sync-public-assets.bat

# Test locally
php artisan serve

# Check files
dir public\styles
dir public\scripts

# Audit
npm run audit:guard

# Deploy
git push origin main
```

---

âœ… **Asset management configured!**
