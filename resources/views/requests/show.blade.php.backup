@php































    use Illuminate\Support\Facades\Storage;































@endphp































<x-app-layout>































    <x-slot name="header">































        <h2 class="font-semibold text-xl text-gray-800 leading-tight">































            Permintaan Pengujian #{{ $request->request_number }}































        </h2>































    </x-slot>































@php































    $sampleReceipt = $request->documents->where('document_type', 'sample_receipt')->last();































    $letterReceipt = $request->documents->where('document_type', 'request_letter_receipt')->last();































@endphp































    <div class="max-w-6xl mx-auto sm:px-6 lg:px-8 space-y-6">































        @if(session('success'))































            <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg">































                <p class="font-semibold">{{ session('success') }}</p>































                @if(session('documents_generated'))































                    <p class="text-sm mt-1">Dokumen tanda terima sudah tersedia di bawah. Gunakan tombol unduh untuk mencetak.</p>































                @endif































            </div>>































        @endif































        <div class="bg-white shadow-sm sm:rounded-lg">































            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">































                <div>































                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Data Penyidik</h3>































                    <dl class="space-y-2 text-sm text-gray-700">































                        <div class="flex justify-between">































                            <dt class="font-medium text-gray-600">Nama</dt>































                            <dd>{{ $request->investigator->name ?? '-' }}</dd>































                        </div>































                        <div class="flex justify-between">































                            <dt class="font-medium text-gray-600">NRP</dt>































                            <dd>{{ $request->investigator->nrp ?? '-' }}</dd>































                        </div>































                        <div class="flex justify-between">































                            <dt class="font-medium text-gray-600">Pangkat</dt>































                            <dd>{{ $request->investigator->rank ?? '-' }}</dd>































                        </div>































                        <div class="flex justify-between">































                            <dt class="font-medium text-gray-600">Satuan</dt>































                            <dd>{{ $request->investigator->jurisdiction ?? '-' }}</dd>































                        </div>































                        <div class="flex justify-between">































                            <dt class="font-medium text-gray-600">Kontak</dt>































                            <dd>{{ $request->investigator->phone ?? '-' }}</dd>































                        </div>































                    </dl>































                </div>































                <div>































                    <h3 class="text-lg font-semibold text-gray-900 mb-3">Informasi Kasus</h3>































                    <dl class="space-y-2 text-sm text-gray-700">















                        <div>















                            <dt class="font-medium text-gray-600">Nama Tersangka</dt>















                            <dd>{{ $request->suspect_name ?? '-' }}</dd>















                        </div>















                        <div>















                            <dt class="font-medium text-gray-600">Jenis Kelamin Tersangka</dt>















                            <dd>{{ $request->suspect_gender === 'male' ? 'Laki-laki' : ($request->suspect_gender === 'female' ? 'Perempuan' : '-') }}</dd>















                        </div>















                        <div>















                            <dt class="font-medium text-gray-600">Umur Tersangka</dt>















                            <dd>{{ $request->suspect_age !== null ? $request->suspect_age . ' tahun' : '-' }}</dd>















                        </div>















                    </dl>































                </div>































            </div>































        </div>































        <div class="bg-white shadow-sm sm:rounded-lg">































            <div class="p-6">































                <h3 class="text-lg font-semibold text-gray-900 mb-4">Daftar Sampel</h3>

@if ($request->samples->isNotEmpty())
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase">Kode</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase">Nama</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase">Jenis Pengujian</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase">Zat Aktif</th>
                    <th class="px-4 py-2 text-left font-medium text-gray-500 uppercase">Hasil Pengujian</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                @foreach ($request->samples as $sample)
                    @php
                        $methodLabels = [
                            'uv_vis' => 'Identifikasi Spektrofotometri UV-VIS',
                            'gc_ms' => 'Identifikasi GC-MS',
                            'lc_ms' => 'Identifikasi LC-MS',
                        ];
                        $methods = collect($sample->test_methods ?? [])->map(fn ($value) => $methodLabels[$value] ?? ucfirst(str_replace('_', ' ', $value)));
                    @endphp
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-2 font-medium text-gray-900">{{ $sample->sample_code }}</td>
                        <td class="px-4 py-2 text-gray-700">{{ $sample->sample_name }}</td>
                        <td class="px-4 py-2 text-gray-700">
                            @if ($methods->isNotEmpty())
                                <ul class="list-disc list-inside space-y-1 text-gray-700">
                                    @foreach ($methods as $method)
                                        <li>{{ $method }}</li>
                                    @endforeach
                                </ul>
                            @else
                                <span class="text-gray-400">-</span>
                            @endif
                        </td>
                        <td class="px-4 py-2 text-gray-700">{{ $sample->active_substance ?? '-' }}</td>
                        <td class="px-4 py-2 text-gray-700">
                            @if ($sample->testResult)
                                {{ $sample->testResult->summary ?? '-' }}
                            @else
                                <span class="text-gray-400 italic">Belum ada hasil</span>
                            @endif
                        </td>
                    </tr>
                @endforeach
            </tbody>
        </table>
    </div>
@else
    <p class="text-sm text-gray-500">Belum ada sampel terdaftar.</p>
@endif

<h3 class="text-lg font-semibold text-gray-900 mb-4">Dokumen Pendukung</h3>































                @if ($request->documents->isNotEmpty())































                    <ul class="divide-y divide-gray-200 text-sm">































                        @foreach ($request->documents as $document)































                            <li class="py-3 flex items-center justify-between">































                                <div>































                                    <p class="font-medium text-gray-900">{{ ucfirst(str_replace('_', ' ', $document->document_type)) }}</p>































                                    <p class="text-xs text-gray-500">{{ $document->original_filename }} ({{ number_format(($document->file_size ?? 0) / 1024, 2) }} KB)</p>































                                </div>































                                <a href="{{ route('requests.documents.download', [$request->id, $document->document_type]) }}" class="text-blue-600 hover:text-blue-800 text-xs font-medium" target="_blank" rel="noopener">































                                    Unduh Dokumen































                                </a>































                            </li>































                        @endforeach































                    </ul>































                @else































                    <p class="text-sm text-gray-500">Belum ada dokumen yang diunggah.</p>































                @endif































            </div>































        </div>































        <div class="flex justify-end space-x-2">































            <a href="{{ route('requests.edit', $request) }}" class="inline-flex items-center px-4 py-2 border border-indigo-600 text-indigo-600 text-sm font-medium rounded-md hover:bg-indigo-50">































                Edit Permintaan































            </a>































            <a href="{{ route('requests.index') }}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50">































                Kembali ke Daftar































            </a>































        </div>































    </div>































</x-app-layout>